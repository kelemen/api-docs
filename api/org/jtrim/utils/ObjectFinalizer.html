<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="hu">
<head>
<!-- Generated by javadoc (version 1.7.0_13) on Mon Feb 11 02:59:34 CET 2013 -->
<title>ObjectFinalizer (JTrim - All modules)</title>
<meta name="date" content="2013-02-11">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ObjectFinalizer (JTrim - All modules)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jtrim/utils/ExceptionHelper.html" title="class in org.jtrim.utils"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jtrim/utils/ShutdownHelper.html" title="class in org.jtrim.utils"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jtrim/utils/ObjectFinalizer.html" target="_top">Frames</a></li>
<li><a href="ObjectFinalizer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.jtrim.utils</div>
<h2 title="Class ObjectFinalizer" class="title">Class ObjectFinalizer</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.jtrim.utils.ObjectFinalizer</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public final class <span class="strong">ObjectFinalizer</span>
extends java.lang.Object</pre>
<div class="block">Defines a simple safety-net for objects managing unmanaged resources (e.g.:
 files).
 <P>
 <code>ObjectFinalizer</code> takes a <code>Runnable</code> in its constructor and
 allows it to be called in the <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> method.
 Also, <code>ObjectFinalizer</code> declares a <code>finalizer</code>,
 in which it will call <code>run()</code> method of the specified <code>Runnable</code>
 if it was not called manually (by calling <code>doFinalize()</code>).
 <P>
 Once the <code>doFinalize()</code> method of an <code>ObjectFinalizer</code> was called
 it will no longer retain a reference to the <code>Runnable</code> specified at
 construction time.
 <P>
 See the following example code using <code>ObjectFinalizer</code>:
 <code><pre>
 class UnmanagedResourceHolder implements Closable {
   privata final ObjectFinalizer finalizer;

   // Other declarations ...

   public UnmanagedResourceHolder() {
     // Initialization code ...

     this.finalizer = new ObjectFinalizer(new Runnable() {
       public void run() {
         doCleanup();
       }
     }, "UnmanagedResourceHolder.cleanup");
   }

   // Other code ...

   private void doCleanup() {
     // cleanup unmanaged resources
   }

   @Override
   public void close() {
     finalizer.doFinalize();
   }
 }
 </pre></code>
 <P>
 Assume, that in the above code an <code>UnmanagedResourceHolder</code> instance
 becomes unreachable and as such is eligible for garbage collection. Notice
 that in this case <code>finalizer</code> also becomes unreachable and such also
 eligible for garbage collection. Also assume that the <code>close()</code> method
 was not called. In this case when the JVM decides to cleanup the now
 unreachable <code>finalizer</code> instance, it will call its finalizer and in
 turn invoke the <code>doCleanup()</code> method releasing the unmanaged resources.

 <h3>Unmanaged Resources</h3>
 In Java a garbage collector is employed, so the programmer is relieved from
 the burden (mostly) of manual memory management. However, the garbage
 collector cannot handle anything beyond the memory allocated for objects, so
 other unmanaged resources require a cleanup method. Although there are
 <code>finalizers</code> in Java, they are unreliable and the
 only correct solution is the use of a cleanup method. Generally, objects
 managing unmanaged resources should implement the <code>AutoCloseable</code>
 interface.
 <P>
 Notice however, that a bug may prevent the program to call the cleanup
 method of an object, causing the leakage of unmanaged resource, possibly
 leading to resource exhaustion. In this case finalizers can be useful to
 provide a safety-net, that even in the case of such previously mentioned bug,
 a finalizer can be implemented to do the cleanup, so when the JVM actually
 removes the object, it may cleanup the unmanaged resources.

 <h3>Benefits of <code>ObjectFinalizer</code></h3>
 One may ask what are the benefits of using <code>ObjectFinalizer</code> instead of
 directly declaring a finalizer. There are actually three main benefits of
 using <code>ObjectFinalizer</code>:
 <P>
 There is a penalty for declaring a <code>finalize()</code> method in a class: Such
 objects are slower to be created and will be garbage collected later. There
 is nothing to be done about slower object creation but the use of
 <code>ObjectFinalizer</code> will help with the slower garbage collection.
 It is assumed that the common case is that the <code>doFinalize()</code> method is
 called from the code correctly without relying on the object finalizer
 (ideally this should always be the case). In this case once the
 <code>doFinalize()</code> method was called, the <code>ObjectFinalizer</code> will
 store no reference to the object it cleaned up, allowing this object to be
 garbage collected. Note that the <code>ObjectFinalizer</code> instance will still
 suffer from the slower garbage collection but an <code>ObjectFinalizer</code>
 whose <code>doFinalize()</code> method was called is relatively cheap in terms of
 retained memory. So this can be a considerable benefit if the object
 protected by the <code>ObjectFinalizer</code> retains considerable amount of
 memory.
 <P>
 Notice that the <code>run()</code> method of the specified <code>Runnable</code>
 instance can only be called at most once even if the <code>doFinalize()</code>
 method is called concurrently multiple times. This effectively makes the
 cleanup method idempotent for free which makes the cleanup method safer.
 <P>
 In case the cleanup method was failed to be called, the
 <code>ObjectFinalizer</code> will log this failure when it detects in its
 finalizer, that the <code>doFinalize()</code> method was not called. So this error
 will be documented in the logs and can be analyzed later.

 <h3>Thread safety</h3>
 This class is safe to be used by multiple threads concurrently.

 <h4>Synchronization transparency</h4>
 Unless otherwise noted, methods of this class are not
 <I>synchronization transparent</I>.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#ObjectFinalizer(java.lang.Runnable)">ObjectFinalizer</a></strong>(java.lang.Runnable&nbsp;finalizerTask)</code>
<div class="block">Creates a new <code>ObjectFinalizer</code> using the specified
 <code>Runnable</code> to be called by the <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a>
 method.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#ObjectFinalizer(java.lang.Runnable, java.lang.String)">ObjectFinalizer</a></strong>(java.lang.Runnable&nbsp;finalizerTask,
               java.lang.String&nbsp;taskDescription)</code>
<div class="block">Creates a new <code>ObjectFinalizer</code> using the specified
 <code>Runnable</code> to be called by the <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a>
 method and a task description to be used in logs if <code>doFinalize()</code>
 is only called in the finalizer.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#checkNotFinalized()">checkNotFinalized</a></strong>()</code>
<div class="block">Throws an <code>IllegalStateException</code> if the
 <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> method has already been called.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()">doFinalize</a></strong>()</code>
<div class="block">Invokes the task specified at construction time if it was not called yet.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#finalize()">finalize</a></strong>()</code>
<div class="block">Invokes the task specified at construction time if it has not been called
 yet.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#isFinalized()">isFinalized</a></strong>()</code>
<div class="block">Returns <code>true</code> if <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> has already
 been called.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/jtrim/utils/ObjectFinalizer.html#markFinalized()">markFinalized</a></strong>()</code>
<div class="block">Sets the state as if <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> has been called
 but does not actually call <code>doFinalize</code>.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ObjectFinalizer(java.lang.Runnable)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ObjectFinalizer</h4>
<pre>public&nbsp;ObjectFinalizer(java.lang.Runnable&nbsp;finalizerTask)</pre>
<div class="block">Creates a new <code>ObjectFinalizer</code> using the specified
 <code>Runnable</code> to be called by the <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a>
 method.
 <P>
 The task description to be used in the log when <code>doFinalize()</code>
 is failed to get called is the result of the <code>toString()</code>
 method of the specified task. The result of the <code>toString()</code> is
 retrieved in this constructor call and not when actually required.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>finalizerTask</code> - the task to be invoked by the <code>doFinalize()</code>
   method to cleanup unmanaged resources. This argument cannot be
   <code>null</code>.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.NullPointerException</code> - thrown if the specified task is
   <code>null</code> or its <code>toString()</code> method returns <code>null</code></dd></dl>
</li>
</ul>
<a name="ObjectFinalizer(java.lang.Runnable, java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ObjectFinalizer</h4>
<pre>public&nbsp;ObjectFinalizer(java.lang.Runnable&nbsp;finalizerTask,
               java.lang.String&nbsp;taskDescription)</pre>
<div class="block">Creates a new <code>ObjectFinalizer</code> using the specified
 <code>Runnable</code> to be called by the <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a>
 method and a task description to be used in logs if <code>doFinalize()</code>
 is only called in the finalizer.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>finalizerTask</code> - the task to be invoked by the <code>doFinalize()</code>
   method to cleanup unmanaged resources. This argument cannot be
   <code>null</code>.</dd><dd><code>taskDescription</code> - the description to be added to the log message
   if the <code>doFinalize()</code> only gets called in the finalizer</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.NullPointerException</code> - thrown if the specified task or the task
   description is <code>null</code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="markFinalized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>markFinalized</h4>
<pre>public&nbsp;void&nbsp;markFinalized()</pre>
<div class="block">Sets the state as if <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> has been called
 but does not actually call <code>doFinalize</code>. This method is useful if
 the object has been finalized in another way, so it is no longer an error
 not to finalize the object.
 <P>
 After calling this method, subsequent <code>doFinalize()</code> method calls
 will do nothing.</div>
</li>
</ul>
<a name="doFinalize()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doFinalize</h4>
<pre>public&nbsp;boolean&nbsp;doFinalize()</pre>
<div class="block">Invokes the task specified at construction time if it was not called yet.
 The task will be called only once, even if this method is called
 concurrently by multiple threads.
 <P>
 The task is invoked synchronously on the current calling thread. Note
 that therefore, this method will propagate every exception to the caller
 thrown by the task.
 <P>
 Once this method returns (even if the called task throws an exception),
 the task specified at construction time will no longer be referenced by
 this <code>ObjectFinalizer</code>.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd><code>true</code> if this method actually invoked the task specified
   at construction time, <code>false</code> if <code>doFinalize()</code> was already
   called (or another <code>doFinalize()</code> is executing the task
   concurrently)</dd></dl>
</li>
</ul>
<a name="isFinalized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isFinalized</h4>
<pre>public&nbsp;boolean&nbsp;isFinalized()</pre>
<div class="block">Returns <code>true</code> if <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> has already
 been called. In case this method returns <code>true</code>, subsequent calls
 to <code>doFinalize()</code> will do nothing but return immediately to the
 caller.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd><code>true</code> if <code>doFinalize()</code> has already
   been called, <code>false</code> otherwise</dd></dl>
</li>
</ul>
<a name="checkNotFinalized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkNotFinalized</h4>
<pre>public&nbsp;void&nbsp;checkNotFinalized()</pre>
<div class="block">Throws an <code>IllegalStateException</code> if the
 <a href="../../../org/jtrim/utils/ObjectFinalizer.html#doFinalize()"><code>doFinalize()</code></a> method has already been called. This
 method can be used to implement a fail-fast behaviour when the object
 this <code>ObjectFinalizer</code> protects is being used after cleanup.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - thrown if <code>doFinalize()</code> has already
   been called. That is, if <a href="../../../org/jtrim/utils/ObjectFinalizer.html#isFinalized()"><code>isFinalized()</code></a> returns
   <code>true</code>.</dd></dl>
</li>
</ul>
<a name="finalize()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>finalize</h4>
<pre>protected&nbsp;void&nbsp;finalize()</pre>
<div class="block">Invokes the task specified at construction time if it has not been called
 yet. In case the task has already been called, this method does nothing
 but returns immediately.
 <P>
 If the task has not been called previously (which is considered to be an
 error), this method will log a <code>SEVERE</code> level log
 message using the <code>java.util.logging</code> facility. The logging will be
 done even if the task throws an exception in which case this exception
 will also be attached to the log message.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code>finalize</code>&nbsp;in class&nbsp;<code>java.lang.Object</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jtrim/utils/ExceptionHelper.html" title="class in org.jtrim.utils"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jtrim/utils/ShutdownHelper.html" title="class in org.jtrim.utils"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jtrim/utils/ObjectFinalizer.html" target="_top">Frames</a></li>
<li><a href="ObjectFinalizer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
